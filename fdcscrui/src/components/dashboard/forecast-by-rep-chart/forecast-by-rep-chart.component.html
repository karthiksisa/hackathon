<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm h-full">
  <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">{{ title() }}</h3>
  @if (chartData().bars.length > 0) {
    @if(scope()?.role !== 'Sales Rep') {
      <!-- Bar Chart for Admin/Lead -->
      <div class="flex items-end h-72 space-x-4">
        @for(bar of chartData().bars; track bar.repId) {
          <div class="flex flex-col items-center flex-1">
            <div class="w-full flex flex-col h-full justify-end">
              <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-t-md" [style.height.%]="100 - bar.heightPercent"></div>
              <div class="w-full bg-orange-400" [style.height.%]="(bar.stalledValue / chartData().maxAmount) * 100" title="Stalled: {{bar.stalledValue | currency:'INR'}}"></div>
              <div class="w-full bg-green-500 rounded-b-md" [style.height.%]="(bar.inProgressValue / chartData().maxAmount) * 100" title="In Progress: {{bar.inProgressValue | currency:'INR'}}"></div>
            </div>
            <span class="text-xs text-gray-600 dark:text-gray-400 mt-2 text-center truncate w-full">{{ bar.repName }}</span>
          </div>
        }
      </div>
    } @else {
      <!-- Donut for Sales Rep -->
      @if (chartData().bars[0]; as repData) {
        <div class="flex items-center justify-center h-72">
           <div class="relative w-48 h-48">
              <svg class="w-full h-full" viewBox="0 0 36 36">
                  <path class="text-orange-400" stroke="currentColor" stroke-width="4" fill="none"
                      [attr.stroke-dasharray]="repData.stalledPercent + ', 100'"
                      d="M18 2.0845
                         a 15.9155 15.9155 0 0 1 0 31.831
                         a 15.9155 15.9155 0 0 1 0 -31.831" />
                  <path class="text-green-500" stroke="currentColor" stroke-width="4" fill="none"
                      [attr.stroke-dasharray]="repData.inProgressPercent"
                      [attr.stroke-dashoffset]="-repData.stalledPercent"
                      d="M18 2.0845
                         a 15.9155 15.9155 0 0 1 0 31.831
                         a 15.9155 15.9155 0 0 1 0 -31.831" />
              </svg>
              <div class="absolute inset-0 flex flex-col items-center justify-center">
                  <span class="text-2xl font-bold text-gray-800 dark:text-gray-100">{{ repData.total | currency:'INR':'symbol-narrow':'1.0-0' }}</span>
                  <span class="text-sm text-gray-500 dark:text-gray-400">Total</span>
              </div>
           </div>
        </div>
      }
    }
     <!-- Legend -->
    <div class="flex justify-center space-x-6 mt-4 pt-4 border-t dark:border-gray-700">
        <div class="flex items-center">
            <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
            <span class="text-sm text-gray-600 dark:text-gray-300">In Progress</span>
        </div>
         <div class="flex items-center">
            <span class="w-3 h-3 bg-orange-400 rounded-full mr-2"></span>
            <span class="text-sm text-gray-600 dark:text-gray-300">Stalled</span>
        </div>
    </div>
  } @else {
    <div class="flex items-center justify-center h-48">
      <p class="text-gray-500 dark:text-gray-400">No forecast data available.</p>
    </div>
  }
</div>